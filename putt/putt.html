<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Putting Calculator</title>
    <style>
        /* Í∏∞Î≥∏ Ïä§ÌÉÄÏùº Ï¥àÍ∏∞Ìôî */
        * { box-sizing: border-box; margin: 0; padding: 0; font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; }
        
        body { 
            background-color: #f0f2f5; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            min-height: 100vh; 
            padding: 20px; 
        }
        
        .container { 
            background-color: white; 
            width: 100%; 
            max-width: 400px; 
            min-height: 700px; 
            display: flex;
            flex-direction: column;
            border-radius: 20px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            padding: 20px; 
            position: relative;
        }

        h2 { text-align: center; color: #333; margin-bottom: 20px; font-size: 1.5rem; margin-top: 10px; }
        
        /* ÏÉàÎ°úÍ≥†Ïπ® Î≤ÑÌäº Ïä§ÌÉÄÏùº (ÌÉÄÏù¥ÌãÄ ÏÇ¥Ïßù ÏïÑÎûò Ïò§Î•∏Ï™Ω ÎÅù) */
        .refresh-btn {
            position: absolute;
            top: 45px;
            right: 20px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s;
            padding: 5px;
        }
        .refresh-btn:hover { opacity: 1; }

        .section { margin-bottom: 20px; }
        .section-title { font-size: 0.9rem; color: #666; margin-bottom: 8px; font-weight: 600; }
        
        .btn-group { display: flex; gap: 10px; }
        
        .btn {
            flex: 1;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 12px;
            background-color: white;
            font-size: 1rem;
            font-weight: 500;
            color: #555;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-speed.active { background-color: #2e7d32; color: white; border-color: #2e7d32; font-weight: 700; }
        .btn-uphill.active { background-color: #ffcdd2; color: #ffffff; border-color: #ffcdd2; font-weight: 700; }
        .btn-downhill.active { background-color: #bbdefb; color: #ffffff; border-color: #bbdefb; font-weight: 700; }

        .input-group { margin-bottom: 12px; }
        .input-label { display: block; margin-bottom: 6px; font-size: 0.95rem; color: #333; }
        
        input[type="number"] { 
            width: 100%; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 12px; 
            font-size: 1.1rem; 
            outline: none; 
            transition: border-color 0.2s; 
        }
        input[type="number"]:focus { border-color: #333; }

        .result-box { 
            background-color: #eceff1; 
            border-radius: 15px; 
            padding: 20px; 
            text-align: center; 
            margin-top: 10px; 
            display: flex;
            flex-direction: column;
            justify-content: center;
            min-height: 100px;
        }
        .result-label { font-size: 0.9rem; color: #546e7a; margin-bottom: 5px; }
        .result-value { font-size: 2rem; font-weight: 800; color: #263238; }

        /* Tip Ïä§ÌÉÄÏùº */
        .tip-toggle {
            text-align: center;
            margin-top: 25px;
            cursor: pointer;
            font-size: 0.95rem;
            color: #f57f17; 
            font-weight: 600;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 10px;
            background-color: #fff8e1;
            border-radius: 10px;
        }

        .tip-panel {
            display: none;
            background-color: #fffde7; 
            border: 1px solid #fff9c4;
            border-radius: 12px;
            padding: 15px;
            margin-top: 10px;
            animation: fadeIn 0.3s;
            font-size: 0.85rem;
            color: #444;
        }

        .tip-table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
        .tip-table th { text-align: left; padding: 5px; border-bottom: 1px solid #ddd; color: #f57f17; }
        .tip-table td { padding: 5px; border-bottom: 1px solid #eee; }
        .tip-table tr:last-child td { border-bottom: none; }
        .tip-header { font-weight: bold; margin-bottom: 5px; color: #333; margin-top: 5px;}

        /* ÏÑ§Ï†ï Ïä§ÌÉÄÏùº */
        .settings-toggle {
            text-align: center;
            margin-top: 15px; 
            cursor: pointer;
            font-size: 0.85rem;
            color: #90a4ae;
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .settings-panel {
            display: none;
            background-color: #fafafa;
            border: 1px solid #eee;
            border-radius: 12px;
            padding: 15px;
            margin-top: 10px;
            animation: fadeIn 0.3s;
        }

        .settings-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        .settings-row:last-child { margin-bottom: 0; }
        .settings-label { font-size: 0.85rem; color: #555; }
        .settings-input { width: 80px !important; padding: 8px !important; font-size: 0.9rem !important; text-align: right; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .version { 
            text-align: right; 
            font-size: 0.75rem; 
            color: #b0bec5; 
            margin-right: 5px; 
            position: absolute;
            bottom: 15px;
            right: 20px;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>Putting Calculator</h2>
        <button class="refresh-btn" onclick="forceReload()" title="ÏÉàÎ°úÍ≥†Ïπ®">üîÑ</button>

        <div class="section">
            <div class="section-title">Green Speed</div>
            <div class="btn-group" id="green-speed-group">
                <button class="btn btn-speed active" onclick="selectSpeed(this, 'slight')">ÏïΩÍ∞Ñ Îπ†Î¶Ñ</button>
                <button class="btn btn-speed" onclick="selectSpeed(this, 'very')">Îß§Ïö∞ Îπ†Î¶Ñ</button>
            </div>
        </div>

        <div class="section">
            <div class="section-title">Slope Type</div>
            <div class="btn-group" id="slope-type-group">
                <button class="btn btn-uphill active" onclick="selectSlopeType(this, 'uphill')">Uphill putt</button>
                <button class="btn btn-downhill" onclick="selectSlopeType(this, 'downhill')">Downhill putt</button>
            </div>
        </div>

        <div class="section">
            <div class="input-group">
                <label class="input-label">Putt length (m)</label>
                <input type="number" id="putt-length" placeholder="0.00" step="0.01" inputmode="decimal" oninput="limitDecimalPlaces(this); calculate()">
            </div>
            <div class="input-group">
                <label class="input-label">Slope (integer)</label>
                <input type="number" id="slope-degree" placeholder="0" step="1" inputmode="numeric" pattern="[0-9]*" oninput="limitInteger(this); calculate()">
            </div>
        </div>

        <div class="result-box">
            <div class="result-label">Recommended Distance</div>
            <div class="result-value" id="result-display">0.00 m</div>
        </div>

        <div class="tip-toggle" onclick="toggleTip()">
            <span>üí° Ball Speed Guide (Click)</span>
        </div>
        <div class="tip-panel" id="tip-panel">
            <div class="tip-header">1. ÏïΩÍ∞Ñ Îπ†Î¶Ñ (2.6 m/s)</div>
            <table class="tip-table">
                <tr><td>3m : 2.5 m/s</td> <td>10m : 4.7 m/s</td></tr>
                <tr><td>5m : 3.2 m/s</td> <td>15m : 5.6 m/s</td></tr>
                <tr><td>7m : 3.9 m/s</td> <td>20m : 6.3 m/s</td></tr>
            </table>

            <div class="tip-header">2. Îß§Ïö∞ Îπ†Î¶Ñ (3.1 m/s)</div>
            <table class="tip-table" style="margin-bottom: 0;">
                <tr><td>3m : 2.1 m/s</td> <td>10m : 4.2 m/s</td></tr>
                <tr><td>5m : 2.9 m/s</td> <td>15m : 5.6 m/s</td></tr>
                <tr><td>7m : 3.5 m/s</td> <td></td></tr>
            </table>
        </div>

        <div class="settings-toggle" onclick="toggleSettings()">
            <span>‚öôÔ∏è Calibration Settings</span>
        </div>

        <div class="settings-panel" id="settings-panel">
            <div style="font-size:0.8rem; color:#888; margin-bottom:10px; text-align:center;">
                Real Slope Threshold: 0.2 (Input 20)
            </div>
            <div class="settings-row">
                <span class="settings-label">Low Slope Factor (&lt; 20)</span>
                <input type="number" id="low-factor" class="settings-input" value="10" oninput="saveSettings(); calculate()">
            </div>
            <div class="settings-row">
                <span class="settings-label">High Slope Factor (‚â• 20)</span>
                <input type="number" id="high-factor" class="settings-input" value="15" oninput="saveSettings(); calculate()">
            </div>
            </div>

        <div class="version">Ver 3.01</div>
    </div>

    <script>
        let currentSpeed = 'slight'; 
        let currentSlopeType = 'uphill'; 

        window.onload = function() {
            loadSettings();
        };

        // Í∞ïÏ†ú ÏÉàÎ°úÍ≥†Ïπ® (Ï∫êÏãú Î¨¥Ïãú) Í∏∞Îä•
        function forceReload() {
            const currentUrl = window.location.href.split('?')[0]; // Í∏∞Ï°¥ ÌååÎùºÎØ∏ÌÑ∞ Ï†úÍ±∞
            window.location.href = currentUrl + '?t=' + new Date().getTime(); // ÌòÑÏû¨ ÏãúÍ∞ÑÏùÑ Î∂ôÏó¨ÏÑú ÏÉàÎ°úÏö¥ ÌéòÏù¥ÏßÄÎ°ú Ïù∏ÏãùÌïòÍ≤å Ìï®
        }

        function selectSpeed(element, value) {
            currentSpeed = value;
            updateBtnActive('green-speed-group', element);
            calculate();
        }

        function selectSlopeType(element, value) {
            currentSlopeType = value;
            updateBtnActive('slope-type-group', element);
            calculate();
        }

        function updateBtnActive(groupId, activeBtn) {
            const group = document.getElementById(groupId);
            const buttons = group.getElementsByClassName('btn');
            for (let btn of buttons) {
                btn.classList.remove('active');
            }
            activeBtn.classList.add('active');
        }

        // Í±∞Î¶¨ ÏûÖÎ†•: ÏÜåÏàòÏ†ê 2ÏûêÎ¶¨ Ï†úÌïú
        function limitDecimalPlaces(e) {
            let t = e.value;
            if (t.indexOf(".") >= 0 && t.substr(t.indexOf(".") + 1).length > 2) {
                e.value = t.substr(0, t.indexOf(".") + 3);
            }
        }

        // Í≤ΩÏÇ¨ ÏûÖÎ†•: Ï†ïÏàòÎßå ÌóàÏö© (ÏÜåÏàòÏ†ê Ï†úÍ±∞)
        function limitInteger(e) {
            e.value = e.value.replace(/[^0-9]/g, ''); 
        }

        function floorToTwo(num) {
            return Math.floor(num * 100) / 100;
        }

        function toggleTip() {
            const panel = document.getElementById('tip-panel');
            panel.style.display = (panel.style.display === 'block') ? 'none' : 'block';
        }

        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            panel.style.display = (panel.style.display === 'block') ? 'none' : 'block';
        }

        function saveSettings() {
            const lowVal = document.getElementById('low-factor').value;
            const highVal = document.getElementById('high-factor').value;
            
            if(lowVal) localStorage.setItem('golf_low_factor', lowVal);
            if(highVal) localStorage.setItem('golf_high_factor', highVal);
        }

        function loadSettings() {
            const savedLow = localStorage.getItem('golf_low_factor');
            const savedHigh = localStorage.getItem('golf_high_factor');

            if (savedLow !== null) document.getElementById('low-factor').value = savedLow;
            if (savedHigh !== null) document.getElementById('high-factor').value = savedHigh;
        }

        function calculate() {
            const lengthInput = document.getElementById('putt-length').value;
            const slopeInput = document.getElementById('slope-degree').value;
            
            const lowFactor = parseFloat(document.getElementById('low-factor').value) || 10;
            const highFactor = parseFloat(document.getElementById('high-factor').value) || 15;
            
            const inputThreshold = 20; 

            const display = document.getElementById('result-display');

            let length = parseFloat(lengthInput);
            let slopeInt = parseFloat(slopeInput); 

            if (isNaN(length) || isNaN(slopeInt)) {
                display.innerText = "0.00 m";
                return;
            }

            let realSlope = slopeInt / 100; 

            let result = 0;
            let appliedFactor = 0;

            if (slopeInt < inputThreshold) {
                appliedFactor = lowFactor; 
            } else {
                appliedFactor = highFactor; 
            }

            if (currentSlopeType === 'uphill') {
                result = length + (realSlope * appliedFactor);
            } else {
                result = length - (realSlope * appliedFactor);
            }

            if (currentSpeed === 'very') {
                result = result * 0.6;
            }

            if (result < 0) result = 0;

            const finalResult = floorToTwo(result);
            display.innerText = finalResult.toFixed(2) + " m";
        }
    </script>
</body>
</html>